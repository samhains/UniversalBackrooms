
### SQL (semantic) ###
SELECT
  e.id,
  e.title,
  concat('https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/', e.storage_path) AS imageUrl
FROM eagle_images e
ORDER BY e.caption_embedding <-> [0.021165,0.009272,0.004606,-0.008758,-0.004778,-0.012960,0.015752,0.068435,-0.031610,0.039696,-0.020717,0.041329,-0.008238,0.002275,-0.032294,-0.019769,0.017069,-0.006170,-0.005775,0.028528,0.012822,-0.037405,-0.033901,-0.005555,-0.028001,0.009950,0.007705,0.057161,0.025064,0.012479,0.020428,-0.040987,0.010813,0.011959,0.030266,-0.029739,-0.006770,-0.026815,-0.024076,0.014540,0.015923,-0.022272,-0.026183,0.031030,0.076653,0.018044,0.006664,-0.038906,0.052841,0.039802,-0.016108,-0.013236,-0.031583,-0.000251,-0.010938,0.077285,-0.005331,0.030477,-0.013921,0.006151,-0.004518,0.032242,0.011886,-0.006582,0.030977,0.019045,-0.037062,-0.024418,0.001732,0.021363,-0.029845,0.023062,-0.043331,-0.019664,0.021732,0.010267,0.004488,-0.029845,-0.002894,-0.038168,0.029845,0.030398,-0.037405,-0.011426,-0.010161,-0.023786,-0.036325,0.018492,-0.015528,-0.000432,0.019506,0.002819,-0.045412,0.029713,-0.048784,0.007112,-0.046097,-0.014962,0.008416,0.009970,-0.006253,-0.058109,-0.001176,0.028106,0.000534,0.024892,-0.009615,-0.002155,-0.031662,0.009002,-0.062113,-0.026420,0.030371,0.017148,0.034639,0.016029,0.077549,-0.030161,0.045386,-0.018847,-0.000141,-0.021758,-0.003061,0.015475,0.024247,0.005337,-0.013776,0.017596,0.031610,-0.026394,0.014014,0.029054,0.017991,-0.023075,-0.017003,-0.001844,-0.027737,0.005071,-0.027421,-0.018992,0.011682,0.042567,-0.001166,-0.017570,0.016213,-0.002772,0.005591,0.018307,0.008311,0.032005,0.024181,-0.011156,-0.042752,0.035561,-0.008745,-0.017517,0.027448,0.004636,-0.011116,0.030898,-0.038274,-0.057529,0.038880,-0.019493,0.037879,-0.038248,-0.039933,0.028501,-0.059215,0.055159,-0.017464,0.017082,0.020454,0.032321,0.000890,0.000567,0.008284,-0.003605,0.013566,0.011445,0.014106,0.056634,-0.018571,0.029502,0.004692,0.004774,0.016832,0.010043,0.037115,0.023207,-0.003773,0.037800,0.036904,0.024379,0.013243,-0.060216,0.016753,0.006743,-0.033111,0.028580,-0.038748,0.015344,-0.000955,-0.041725,0.010141,0.031504,-0.068593,0.009410,-0.005347,0.000813,0.065116,0.013039,-0.002759,-0.010622,0.027421,0.010662,0.064009,0.009555,-0.019071,0.017899,0.003069,-0.011314,0.038327,0.030582,0.012150,0.054263,0.004093,-0.051207,0.010899,0.012446,0.040908,0.023470,-0.029502,-0.009252,-0.030740,0.027105,-0.042488,-0.013223,-0.020335,0.004718,-0.013658,0.025762,-0.013803,0.012288,0.034481,0.021297,0.053789,0.026802,0.010938,-0.021692,0.057898,0.026052,-0.033058,-0.068540,-0.005900,0.001773,-0.040513,0.018294,0.005525,-0.029186,-0.006197,-0.005844,-0.015001,-0.035271,0.029212,-0.043358,0.000810,-0.025222,0.007560,-0.040934,0.001548,0.020638,0.012367,-0.008732,-0.010807,0.026104,0.065959,0.005466,-0.008719,0.034586,0.025077,0.021020,-0.002674,-0.039117,-0.030213,-0.008409,0.038300,-0.019216,0.056423,0.037036,0.017649,-0.000348,0.013032,0.013006,-0.035771,-0.043647,-0.011952,-0.007606,-0.009298,-0.042936,0.021916,-0.012861,-0.034902,0.049126,-0.022509,0.025551,0.000179,-0.042594,0.021508,0.020559,-0.016411,-0.014527,0.034244,-0.001560,0.009187,-0.033980,-0.003777,0.022153,0.023404,0.034244,0.006829,-0.026802,0.044991,0.018439,0.000185,-0.056897,-0.003056,-0.020783,0.038142,0.019716,-0.031662,0.005588,0.012762,-0.008844,0.040197,-0.046966,0.004175,-0.004185,-0.036456,0.001622,-0.020270,-0.069699,-0.023957,-0.008844,-0.049074,0.010543,0.057213,-0.019795,0.044253,0.032795,0.054843,0.064536,-0.013579,0.001315,-0.022996,-0.034375,0.059689,0.018360,-0.029186,0.040855,-0.025288,0.019348,0.013948,-0.019111,0.003586,-0.013269,-0.052103,0.002830,0.066959,-0.025880,-0.045676,-0.006180,-0.006279,-0.032927,-0.005209,0.004340,0.046808,0.030582,-0.003013,0.038327,-0.041830,0.064009,0.018492,0.020507,0.002728,0.013776,-0.026750,-0.022798,0.014316,-0.052314,0.064958,-0.039881,0.039960,-0.019255,0.045597,-0.014962,0.035218,-0.021639,0.000673,0.032347,-0.028132,-0.012387,-0.046387,0.053236,0.021350,0.081395,0.012466,-0.048178,0.003309,-0.062692,0.003833,-0.090298,0.028475,0.022430,0.005216,0.013790,-0.009957,-0.029265,-0.022034,0.019519,0.027211,0.043542,-0.022601,0.021771,-0.007850,0.108947,0.043885,-0.029871,0.017714,-0.046940,0.021521,-0.026315,0.014158,0.047994,0.010089,0.035139,0.011636,-0.002300,-0.013974,0.013711,0.081395,0.025077,-0.003833,0.031267,-0.026223,0.021178,0.033348,-0.008442,-0.022509,-0.005591,-0.007066,-0.019479,-0.038432,-0.024919,0.025274,0.033058,0.012855,0.050338,0.008818,-0.021784,0.014027,0.008561,-0.056160,0.010161,0.040302,-0.046756,0.016674,0.029871,0.007073,-0.045123,-0.030793,-0.031768,0.016095,-0.024972,-0.002769,-0.002438,-0.000316,-0.027948,0.029081,0.015620,-0.017899,0.008791,-0.025880,-0.011623,-0.000133,0.040276,0.043489,0.006888,-0.065800,0.016029,-0.013283,0.033401,0.000776,-0.014079,0.034902,-0.037141,-0.074282,0.019611,0.007540,-0.002206,0.013164,-0.006161,-0.034797,-0.025959,-0.007560,0.012920,-0.023813,0.012868,0.038089,0.000664,0.021139,0.014962,-0.039459,-0.002084,-0.007132,0.014949,-0.029739,0.007501,0.001483,-0.041277,0.038037,0.003954,-0.040513,0.001525,0.021073,-0.039986,-0.004653,-0.050549,-0.002585,-0.019598,-0.013144,0.012769,0.027632,0.001044,-0.027974,-0.005034,-0.006572,-0.014949,-0.000672,0.023720,-0.017662,0.022403,-0.011610,-0.010418,-0.043410,0.053921,-0.030134,0.007119,0.000766,0.007185,0.019216,-0.009470,0.006717,-0.029002,-0.005229,-0.012894,0.022680,0.009753,0.003490,0.024418,-0.032084,0.027211,-0.005051,-0.024194,0.000915,0.026776,-0.022430,0.003474,-0.010602,-0.012012,0.032663,-0.001616,-0.038537,-0.070384,0.031873,0.003655,0.009377,-0.036088,0.003154,-0.009022,0.012815,-0.054368,-0.027632,-0.006687,-0.016937,-0.027026,-0.011814,-0.027606,0.005696,-0.011814,0.004485,-0.022166,0.002175,-0.032716,-0.032505,-0.004037,-0.020625,-0.012696,-0.014804,0.022219,-0.027843,0.012525,0.015620,-0.002040,0.015871,-0.027869,-0.008107,0.007935,0.018623,-0.024484,-0.029291,-0.036351,0.037405,-0.004620,-0.027421,-0.006694,-0.020783,-0.004643,-0.003405,0.002092,-0.028211,-0.009727,0.005696,-0.007027,-0.001925,0.000524,-0.022074,0.023022,-0.041856,-0.034165,-0.006319,0.015634,-0.003908,-0.020428,-0.012624,-0.019453,-0.000283,0.004715,0.022443,-0.003133,0.070331,0.012394,0.002237,-0.069541,0.017135,0.012624,0.010932,-0.006572,0.000898,-0.000959,0.008047,0.006029,-0.020467,-0.018044,-0.031583,0.008245,0.001594,-0.062165,-0.008363,0.013961,-0.007685,0.025353,0.030977,-0.007593,-0.044991,0.072649,-0.016740,-0.010253,-0.000760,0.013434,0.073808,0.008344,-0.016332,-0.016147,0.042884,-0.027974,0.000816,-0.039169,0.009187,-0.001831,0.012565,-0.004149,-0.003760,-0.017227,-0.027843,0.018162,0.014659,-0.002828,-0.040908,-0.009496,-0.046729,0.004432,0.005459,-0.006915,-0.002259,-0.009292,0.013882,0.020204,-0.033980,-0.033032,-0.015818,0.010714,-0.013711,0.000877,-0.027342,0.020085,0.015792,0.013724,0.048731,-0.002746,-0.004188,-0.005973,-0.047888,0.069804,-0.011281,0.013408,0.011452,-0.011235,0.002754,-0.000961,0.006388,0.032005,-0.007639,-0.019809,-0.043094,0.007573,0.002926,-0.041540,-0.039459,0.013711,-0.012473,0.020349,0.020717,0.032558,-0.007073,0.000287,-0.018636,0.001888,0.012268,-0.010787,-0.018017,-0.015133,-0.034876,-0.009483,-0.048178,0.024234,-0.021060,-0.030609,-0.032900,0.030240,0.011287,0.009911,0.006566,-0.000488,-0.009035,-0.023971,0.021995,-0.045412,-0.000198,0.018004,0.006177,0.039960,0.029950,-0.008409,0.001166,0.031320,-0.005430,0.009674,-0.027211,0.002995,0.012874,-0.068329,0.006783,-0.002802,-0.003902,0.010451,-0.004106,0.057951,0.007698,0.004834,0.007356,-0.010148,-0.045834,0.045702,-0.013316,-0.014843,-0.006134,-0.019479,-0.001222,0.011327,0.016885,0.011412,0.014145,0.012367,0.033216,0.021086,0.012650,-0.020296,-0.002497,-0.024590,0.033085,0.015238,0.031636,-0.005828,0.006816,0.045491,-0.008218,0.017030,0.004106,0.010043,-0.016648,0.022087,-0.009641,0.023035,0.006954,-0.007270,0.006882,-0.004524,0.009002,-0.009180,0.044359,0.013500,-0.011794,0.011919,-0.054000,-0.008897,0.057108,0.024958,-0.010826,-0.034507,0.002932,-0.019677,0.001413,0.009812,-0.012209,0.007257,0.011775,-0.032479,-0.002996,0.032584,0.025393,0.040012,0.009608,-0.024273,-0.010642,-0.033849,-0.013697,0.020810,-0.000860,0.015857,-0.044517,-0.022113,0.063430,0.004076,0.010872,-0.008554,-0.003003,-0.006809,0.012558,-0.021876,-0.022074,0.038485,0.013078,-0.024827,0.000231,0.007198,-0.024721,0.014685,-0.017451,0.009470,0.034639,0.022588,0.009430,0.033137,0.023865,0.035903,-0.053130,0.026815,-0.015449,-0.019519,-0.015739,0.014540,0.043726,-0.001299,-0.015212,-0.040934,-0.015475,0.061428,0.029687,0.023325,-0.013592,-0.000990,0.000512,-0.075231,0.016674,0.002945,-0.004330,0.024629,0.026829,-0.034138,-0.003372,-0.014567,-0.006704,0.000371,0.051365,0.043015,-0.000975,0.025051,0.004811,0.005538,-0.044622,-0.012242,0.007066,-0.022364,0.014014,0.000638,0.002255,-0.016964,-0.030240,0.005301,0.003576,0.017016,0.010695,-0.002323,0.001410,0.005657,-0.003067,0.005565,0.000951,0.001352,0.053078,0.019348,0.012387,0.051787,0.017003,-0.027290,0.013645,-0.022048,0.000198,-0.011149,0.068540,-0.026236,-0.014698,0.024787,0.015015,-0.009983,0.018847,-0.016595,-0.016911,-0.040645,0.030846,-0.021903,0.042936,-0.012874,0.005993,-0.047230,-0.022232,0.021995,-0.000515,0.018808,-0.005690,-0.007066,-0.001059,-0.015475,-0.009871,-0.003424,-0.009977,-0.009997,0.013111,-0.024194,-0.048205,-0.039617,0.047546,0.006618,-0.002509,0.019493,-0.011498,-0.021771,0.042647,0.015686,0.033901,0.052603,-0.005146,-0.013935,0.006635,0.002670,0.033796,0.005275,-0.030977,-0.009318,-0.003362,-0.006058,-0.016002,-0.007665,-0.008225,0.021837,0.025920,-0.031030,0.035060,0.045175,-0.004422,-0.010174,0.007204,0.007066,-0.016411,-0.006987,0.012479,0.034007,-0.007527,-0.022364,-0.036957,-0.008541,0.029186,-0.013842,-0.032452,-0.023417,0.035929,-0.009121,-0.023128,-0.000524,-0.044622,-0.001625,0.013427,0.010695,-0.002092,-0.045017,0.017201,-0.028580,0.018676,-0.019440,-0.022825,-0.037773,-0.011505,-0.004201,0.011715,0.038379,-0.002761,-0.023589,-0.032663,-0.006720,-0.008429,0.003546,0.020230,-0.015317,-0.032584,-0.022482,-0.032452,-0.023773,0.003350,0.018742,-0.029871,-0.037747,-0.006622,-0.006868,-0.004043,-0.014422,0.035824,-0.033190,-0.016937,0.006862,-0.022008,-0.007040,-0.013763,-0.001972,0.008798,-0.007889,-0.042963,0.034375,0.014791,-0.014738,0.011083,-0.012084,-0.025103,0.027421,-0.005291,-0.035087,-0.011241,0.009061,-0.009318,0.008265,0.004876,-0.007692,0.027369,0.052077,-0.038880,-0.030951,0.033032,-0.003051,0.000066,-0.007869,-0.017649,0.035929,-0.005413,-0.000179,-0.025209,0.020230,0.035008,0.025893,0.018702,0.018794,0.009134,-0.009206,0.024142,-0.006737,-0.034612,0.010411,0.005229,-0.012940,0.017517,-0.006954,0.002825,-0.008192,0.022983,0.012716,-0.006684,-0.012558,-0.035192,-0.023813,-0.031372,0.035587,-0.015028,-0.012143,-0.000246,0.024050,0.002530,-0.017451,0.053051,-0.015805,-0.010102,-0.037694,-0.022667,0.045939,0.024036,0.024352,0.000879,0.006141,0.016279,-0.015383,-0.013961,0.023852,-0.011109,0.037747,0.002557,0.012394,0.008660,0.025972,-0.003816,0.102415,-0.004198,-0.026236,-0.018492,0.005841,-0.018439,-0.001194,0.003902,-0.000952,0.036641,-0.011919,-0.024590,0.018505,-0.012966,0.010754,-0.008805,0.016806,-0.000531,-0.004985,-0.006803,-0.005673,-0.006829,0.019703,0.011531,-0.011485,0.024629,-0.004909,-0.025051,0.019545,0.001148,0.043410,-0.005495,0.015383,0.005301,0.000966,-0.014290,0.013098,-0.020928,0.004768,-0.000583,-0.000435,0.009667,-0.017148,-0.012222,0.045096,-0.004007,0.009101,-0.006506,-0.007698,0.046203,0.027052,0.023707,-0.003444,0.012861,-0.007020,-0.042989,0.010148,0.021521,0.034191,-0.020783,-0.008159,-0.032268,0.033690,-0.007079,0.006605,-0.015620,-0.000000,0.016042,0.008521,0.018281,0.015054,0.030819,0.015396,-0.041277,0.005169,0.005588,0.038010,0.002471,-0.040566,0.033216,-0.012426,0.001461,0.031530,0.000754,0.008232,0.017820,-0.029054,-0.020928,-0.021086,-0.015857,0.023496,-0.009950,0.008949,0.006648,-0.006928,0.014198,0.014909,0.012031,-0.011498,0.007218,0.001441,-0.031583,-0.018584,0.003161,0.016147,0.016292,0.001459,0.017675,-0.017122,-0.007125,-0.001612,-0.004959,0.025314,-0.006717,0.023813,0.016621,-0.016819,0.005848,-0.019558,0.014382,0.006259,-0.020414,0.001678,-0.038458,0.017543,0.000527,-0.024511,0.022153,-0.011735,-0.005433,0.037668,0.017030,0.013856,-0.003133,-0.029397,0.020599,0.005377,-0.011267,-0.008469,0.003497,0.057529,0.039090,0.020507,-0.019637,0.016490,-0.007771,0.050470,0.007165,0.002797,-0.015923,0.002646,0.009957,-0.003652,0.024445,-0.003922,0.003408,-0.015871,0.014817,-0.022430,-0.020731,0.010596,0.022482,-0.009279,0.006411,0.025327,-0.002590,-0.013052,0.042436,-0.037194,-0.011406,0.018900,-0.018452,-0.042251,0.003097,0.020151,0.002279,-0.003915,0.002756,-0.056370,0.015739,-0.002074,-0.001038,0.022245,0.025406,-0.024247,0.046993,0.018571,0.010872,0.042330,0.000349,0.013197,-0.017899,0.022034,-0.001971,-0.030345,0.007343,-0.041329,0.032373,0.013092,-0.015857,-0.014698,-0.008416,-0.002292,0.047809,0.043674,-0.027685,0.014395,0.005601,0.013125,-0.008673,0.019506,-0.012308,0.001455,-0.006088,-0.015976,0.046650,0.031214,0.018189,-0.044359,0.009088,0.004603,-0.017807,0.015383,-0.021020,-0.036009,0.000085,0.035139,0.012104,-0.005746,-0.039407,0.027711,0.043147,0.000708,-0.007277,0.024247,0.035376,-0.017280,0.040197,-0.035376,-0.000003,0.018505,-0.005193,-0.007744,-0.000246,0.002050,0.024273,0.040671,-0.007692,-0.009496,0.034244,-0.045491,0.006829,0.015726,-0.046914,-0.005528,-0.006151,0.029239,-0.000055,0.015107,-0.013974,0.003678,-0.006750,-0.004817,-0.014330,-0.014198,-0.010569,-0.017609,0.024155,0.000538,0.031399,0.048705,-0.013276,0.001571,-0.008969,-0.036483,0.036667,0.013882,0.037721,-0.000672,-0.033822,-0.025064,0.000874,-0.019374,-0.028633,-0.016872,0.031820,-0.020349,0.013803,0.019018,-0.041198,0.032505,-0.013803,0.023035,-0.001778,0.038853,0.011570,0.007520,-0.017741,-0.021718,-0.009134,0.033585,0.016819,-0.003843,0.001984,0.017003,-0.011300,0.020559,0.032057,0.021205,-0.035798,0.028923,0.013592,-0.028528,-0.028106,0.026249,0.046203,-0.000852,0.013829,-0.015686,0.035561,0.039749,0.003925,-0.026921,-0.034823,-0.036088,-0.038643,0.008363,-0.019479,0.027369,0.001189,0.009417,-0.003503,-0.007534,0.004116,-0.022443,-0.030450,-0.024339,0.008745,-0.016937,-0.034823,-0.012209,0.024168,-0.006921,0.022298,0.000585,-0.026763,-0.010576,-0.026460,-0.004320,-0.012966,-0.041250,-0.007356,-0.029081,-0.020665,-0.020335,-0.003125,0.016964,0.015963,-0.043779,0.030977,-0.000812,0.038327,0.025485,0.002259,-0.001581,0.008442,0.011886,0.014198,-0.005291,-0.006622,-0.019901,0.001180,0.004445,0.031162,0.011011,-0.007290,-0.016529,-0.011083,-0.018347,0.016608,-0.008936,0.014988,-0.030872,0.003212,-0.028106,0.028291,-0.004903,0.009298,-0.005578]::vector ASC,
         e.created_at DESC
LIMIT 3;

### SQL (fts+trgm, caption) ###
SELECT
  e.id,
  e.title,
  concat('https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/', e.storage_path) AS imageUrl
FROM eagle_images e
CROSS JOIN LATERAL (
  SELECT
    setweight(to_tsvector('english', unaccent(coalesce(e.caption,''))), 'A') || setweight(to_tsvector('simple',  unaccent(array_to_string(e.tags,' '))), 'B') || setweight(to_tsvector('simple',  unaccent(coalesce(e.title,''))), 'C') AS tsv,
    websearch_to_tsquery('english', unaccent('rainforest')) AS q_web,
    plainto_tsquery('simple',  unaccent('rainforest'))       AS q_plain,
    similarity(unaccent(coalesce(e.caption,'')), unaccent('rainforest')) AS cap_sim,
    similarity(unaccent(coalesce(e.title,'')),   unaccent('rainforest')) AS title_sim,
    (SELECT max(similarity(unaccent(tag), unaccent('rainforest'))) FROM unnest(e.tags) AS tag) AS tag_sim
) s
ORDER BY
  (0.9*COALESCE(ts_rank_cd(s.tsv, s.q_web), 0) + 0.8*COALESCE(ts_rank_cd(s.tsv, s.q_plain), 0)) +
  (0.8*COALESCE(s.cap_sim,0) + 0.6*COALESCE(s.tag_sim,0) + 0.4*COALESCE(s.title_sim,0)) +
  (0.05 * (extract(epoch from (now() - e.created_at)) * -1.0 / 86400.0)) +
  (0.02*random()) DESC,
  e.created_at DESC
LIMIT 3;

### Discord Post ###
Channel: lucid
Media: https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO251FOAKWC8V.jpg
Args: {"channel": "lucid", "message": "", "mediaUrl": "https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO251FOAKWC8V.jpg", "imageUrl": "https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO251FOAKWC8V.jpg"}
Result: {"content": [{"type": "text", "text": "Message sent successfully to #lucid in dreamsim.exe. Message ID: 1416049810191941644", "annotations": null, "_meta": null}], "isError": false, "model": null}

### Discord Post ###
Channel: lucid
Media: https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO2401K9YQLGH.jpg
Args: {"channel": "lucid", "message": "", "mediaUrl": "https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO2401K9YQLGH.jpg", "imageUrl": "https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO2401K9YQLGH.jpg"}
Result: {"content": [{"type": "text", "text": "Message sent successfully to #lucid in dreamsim.exe. Message ID: 1416049820711391334", "annotations": null, "_meta": null}], "isError": false, "model": null}

### Discord Post ###
Channel: lucid
Media: https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO2401K9CQQSJ.jpg
Args: {"channel": "lucid", "message": "", "mediaUrl": "https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO2401K9CQQSJ.jpg", "imageUrl": "https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO2401K9CQQSJ.jpg"}
Result: {"content": [{"type": "text", "text": "Message sent successfully to #lucid in dreamsim.exe. Message ID: 1416049833051033743", "annotations": null, "_meta": null}], "isError": false, "model": null}
