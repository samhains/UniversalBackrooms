
### SQL (semantic) ###
SELECT
  e.id,
  e.title,
  concat('https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/', e.storage_path) AS imageUrl
FROM eagle_images e
ORDER BY e.caption_embedding <-> [-0.009827,0.016907,0.029497,-0.009033,-0.034444,0.014591,-0.003480,-0.001519,-0.020150,0.001474,0.051417,0.009744,-0.017668,0.038712,0.045495,-0.009446,-0.026552,0.015840,-0.012399,0.033749,0.048770,0.014525,0.019587,-0.007163,-0.004024,0.011241,-0.023922,0.012507,0.028240,-0.003300,0.033649,-0.045031,0.004897,-0.051682,-0.011589,0.070475,-0.013152,0.015766,0.005757,-0.017536,0.003979,-0.019935,-0.011812,0.019224,0.008619,-0.017040,-0.059523,0.012292,-0.007453,0.090592,-0.023492,0.015510,-0.001300,0.098533,-0.025907,0.013442,-0.019257,0.049961,0.036958,-0.015758,0.068291,-0.005918,0.027396,-0.035238,-0.025361,0.006204,-0.044370,0.032045,0.016891,-0.016634,-0.022119,-0.027396,-0.020878,0.006262,0.031532,-0.014302,-0.014442,0.008925,0.050391,-0.018380,0.020233,-0.013177,-0.051913,0.006981,0.015534,-0.017966,-0.060417,-0.013152,0.022516,-0.017470,-0.047182,0.019273,-0.048969,0.070608,-0.007292,-0.008859,-0.039837,-0.034807,0.034344,0.017453,0.021556,-0.008201,-0.003954,0.006307,0.028637,0.017652,-0.037157,-0.032028,-0.012383,0.011498,0.051880,0.028885,-0.034477,0.017172,0.042781,-0.021308,0.031036,-0.025907,-0.012424,-0.033517,0.017486,0.032094,0.004843,-0.076828,0.024766,0.008077,-0.009314,0.000118,-0.027975,-0.042781,-0.018860,-0.013905,0.037885,-0.039274,-0.008586,0.032822,-0.037124,-0.008354,-0.056016,0.040498,0.023574,0.038083,0.010695,-0.023641,-0.003542,-0.005865,-0.024683,0.002003,-0.012077,-0.005960,-0.011208,0.001444,-0.026949,-0.033798,-0.028471,-0.040035,0.026999,0.009463,-0.029332,-0.007970,0.005257,-0.056976,-0.013921,0.010009,0.007540,0.010158,-0.032194,0.022648,-0.048108,0.065082,-0.060284,0.016841,-0.061806,-0.001889,-0.003594,0.019372,0.007709,-0.002098,0.001496,0.007048,-0.004967,0.028207,-0.016221,0.003379,0.078615,-0.004285,0.008412,-0.015865,-0.003561,0.010555,-0.038381,0.014343,-0.008818,0.005720,-0.022598,0.001155,0.033004,-0.012267,-0.029067,0.001102,0.012821,0.016808,0.005323,0.010315,-0.035800,-0.048936,-0.021970,0.001737,0.027578,-0.006857,0.087350,0.003797,-0.014509,0.012689,-0.020564,-0.028422,0.055156,0.020646,0.032376,0.018314,-0.035535,0.033501,0.032988,-0.028339,-0.027776,0.100717,0.019257,0.000965,0.007449,-0.009074,0.019124,0.017371,-0.017338,-0.033186,0.021242,0.040664,-0.019008,-0.014385,0.012705,-0.076166,0.007577,0.027512,-0.005087,-0.067961,-0.006990,0.014021,-0.015179,-0.029365,0.002254,0.047645,-0.009099,-0.010869,-0.037289,0.011349,0.021043,0.005009,0.024236,0.012523,-0.004330,-0.050987,-0.016742,-0.053866,-0.034311,-0.065314,-0.017999,0.008160,-0.010687,0.007217,0.010555,0.009802,-0.006985,-0.046917,0.014219,0.020398,-0.000857,0.022036,0.037388,-0.004918,-0.032905,0.050788,-0.036760,0.018611,-0.002155,-0.025609,-0.062534,-0.004864,-0.009140,-0.010431,0.040929,0.002374,-0.003551,-0.012871,-0.004272,-0.056347,-0.032442,0.030440,-0.005844,0.017106,-0.029398,-0.042550,-0.035006,0.025593,0.029050,0.046322,-0.063990,0.104489,0.015237,0.001343,0.016891,-0.027164,0.012813,0.005232,0.048175,-0.027495,0.008991,-0.020398,-0.025229,-0.021755,0.010307,-0.028339,0.099327,-0.043245,0.028207,-0.002073,-0.015410,0.013375,-0.012135,-0.034741,0.016941,-0.028422,0.001823,-0.006985,0.029067,-0.017602,0.020282,0.029563,0.032078,0.011539,-0.007904,-0.047215,-0.001467,-0.021407,-0.029166,-0.022119,0.009661,0.028868,0.042947,-0.019422,0.050855,0.003708,0.003970,0.038976,-0.000815,-0.012242,0.005852,-0.027843,-0.019422,0.045726,0.003207,0.058200,0.008644,0.002597,-0.004425,-0.019108,0.008421,0.064917,-0.064420,0.032938,0.047182,-0.035899,0.016287,-0.002635,0.011175,0.003288,-0.023359,0.002007,0.019604,0.019951,0.027363,-0.012540,0.008611,-0.024203,0.007813,-0.023475,0.023078,0.028984,0.052377,0.027694,-0.067894,0.005501,0.041259,-0.016146,-0.028918,-0.000175,0.014178,0.030093,0.018826,0.068358,0.000536,0.029001,0.017652,-0.000235,-0.007536,0.045825,0.010844,0.014782,0.001604,-0.006109,0.024286,-0.034907,-0.018297,-0.023938,0.021126,0.011886,-0.030854,-0.014517,-0.026288,0.023608,-0.049200,0.030175,-0.014658,0.003737,-0.024666,0.003207,-0.007101,0.017652,-0.005836,-0.031482,0.002432,-0.029613,0.071005,-0.000576,-0.032888,0.031499,0.001780,0.022813,0.008334,0.011663,-0.023624,-0.038315,-0.028703,-0.006580,0.010464,-0.055884,-0.051086,0.036528,0.021788,-0.010166,-0.021325,-0.003054,0.007167,0.031846,-0.000351,0.002941,-0.040895,-0.032574,0.042153,-0.029133,0.002761,0.009761,0.013508,0.030738,0.014765,0.021804,0.017768,0.002527,0.025262,0.044965,0.010497,-0.031565,-0.046851,0.017420,0.033401,0.022036,0.015667,-0.009603,0.043344,-0.012102,-0.002033,-0.068556,-0.012184,0.011977,-0.005956,-0.042153,-0.026834,0.108128,-0.015634,-0.070078,0.005323,0.042153,0.019902,0.045858,-0.038612,-0.022003,-0.014558,-0.052277,0.000940,-0.005360,-0.026685,-0.037421,-0.021705,0.044436,-0.027297,0.015634,0.040862,0.030820,0.007871,-0.004719,0.043013,0.001514,0.029745,0.020679,0.002331,0.006287,-0.040829,-0.019803,-0.025245,-0.005699,0.008867,-0.014939,0.040995,0.013648,0.029646,-0.047546,0.022780,-0.024038,0.004893,-0.039506,-0.023194,-0.036462,0.004206,-0.033550,0.000532,0.034543,-0.011523,0.008350,-0.001372,-0.001383,-0.028471,-0.031532,0.014244,-0.005480,-0.003393,-0.015385,0.004359,0.047116,-0.007325,-0.064917,0.023971,0.007337,-0.009918,-0.017950,-0.012573,-0.001693,0.007949,-0.037951,-0.000278,-0.026420,0.036561,0.008661,-0.014385,-0.004105,-0.024302,-0.049531,-0.016386,0.002386,-0.007763,0.019025,-0.031730,0.008090,-0.001331,-0.002577,-0.010249,-0.002742,-0.036991,0.018644,0.021109,0.001359,-0.026652,-0.028935,-0.027297,-0.009314,0.012135,-0.010042,-0.043013,0.041259,-0.015245,-0.026073,-0.022880,0.035701,0.011762,0.040201,-0.023856,0.013177,0.037355,0.026006,-0.014327,0.020051,-0.058762,-0.012333,0.013524,-0.008785,0.020878,-0.020564,-0.003484,-0.004268,-0.003261,-0.013524,-0.026635,-0.020712,-0.007436,0.050391,0.019124,-0.001227,-0.027909,0.006382,-0.021556,-0.002833,-0.016089,-0.006915,-0.028719,0.000291,-0.007234,-0.004239,-0.002674,0.025692,-0.016626,0.014136,-0.062203,0.011944,-0.018247,0.032458,0.012954,0.003468,-0.048902,-0.019753,0.047877,0.018678,-0.000713,-0.026056,0.030820,0.026933,-0.036727,-0.004417,0.014906,-0.004059,0.033798,0.009926,0.000347,0.016304,-0.027082,-0.027528,0.025527,-0.022499,0.006874,-0.013781,-0.025212,0.042120,-0.038811,0.007068,-0.018380,-0.009380,-0.011001,-0.009281,-0.010174,0.023790,0.009240,0.003518,-0.012813,0.003768,0.013541,0.040962,0.032194,0.017536,0.024104,0.039605,0.030324,-0.053071,-0.018545,0.015493,0.003007,-0.020762,-0.032475,-0.012614,-0.014136,0.022268,0.002800,0.024600,0.026436,-0.018032,-0.019472,0.041656,0.039274,-0.011969,-0.022714,-0.045627,0.018396,-0.015104,0.040664,-0.023839,0.042682,0.008156,-0.033467,-0.014583,0.017304,-0.050458,0.011241,0.000074,0.035006,0.029828,0.022201,0.020663,-0.016436,-0.003683,-0.012135,0.023971,-0.026106,0.022780,0.013673,0.024451,0.017007,0.045660,-0.022168,-0.051053,-0.014682,0.031102,-0.014773,0.010985,-0.010588,0.037289,-0.001194,-0.017437,0.024220,0.024054,-0.018562,-0.003606,-0.023591,-0.018678,-0.006791,-0.044403,-0.011481,-0.018876,0.008776,0.045561,-0.018760,0.001705,-0.029265,0.020597,-0.028306,-0.011663,-0.005575,0.016560,0.014327,0.002939,-0.028223,-0.033352,0.004669,-0.029431,-0.056347,0.020200,0.001031,0.008751,0.011953,0.012565,0.007680,-0.009033,-0.028968,-0.007130,-0.072262,-0.002372,0.018198,-0.028025,0.015361,-0.039837,0.006109,-0.003708,-0.046653,0.012399,-0.020845,0.030556,-0.004521,-0.021407,-0.020348,-0.000365,0.001499,-0.026569,-0.019769,0.003344,0.022234,-0.002515,0.008309,0.012159,-0.002202,-0.023839,0.012714,0.002721,0.037124,-0.022483,-0.028802,0.013988,0.002717,0.005025,0.004198,-0.024633,0.001128,0.024153,-0.004363,-0.024848,-0.021060,-0.004430,-0.007606,0.008119,0.003596,-0.009149,-0.012846,0.014765,0.000502,-0.005513,-0.012854,0.011440,0.028322,-0.020746,0.016428,0.013036,0.022102,0.001943,-0.006320,0.051185,0.016701,-0.017453,0.004860,-0.017023,-0.016031,-0.018065,-0.001618,0.019869,-0.035899,-0.003515,-0.030275,-0.052112,0.016676,0.037554,-0.003400,-0.000579,0.001989,0.016800,-0.002217,0.007118,-0.043509,-0.024914,0.005133,-0.028140,-0.000290,-0.034576,-0.030059,0.011680,-0.003255,-0.010770,0.005914,0.031102,-0.025924,0.024253,-0.015940,-0.043410,0.036793,-0.012085,-0.004363,0.038513,0.017023,-0.052807,0.012714,-0.003565,-0.039373,-0.026519,-0.001535,0.014467,0.023971,0.002980,0.026089,-0.011928,-0.001729,-0.014434,-0.002109,-0.025973,-0.016105,-0.010687,-0.013963,-0.009736,0.012184,0.001613,-0.014103,-0.021143,0.001435,-0.027793,-0.048042,0.001806,-0.036561,0.017586,0.011498,-0.028356,-0.047645,-0.003205,-0.044237,0.006998,0.004289,0.003131,-0.031019,-0.005215,-0.004901,0.063361,-0.005315,0.010464,0.016254,-0.027793,0.036859,-0.017420,-0.051549,0.018396,0.037090,0.004802,-0.047546,-0.036032,0.007118,-0.015518,0.010083,0.022483,0.004876,0.014054,0.018214,-0.004649,0.029613,0.039473,-0.026420,0.008950,0.069218,-0.010563,0.006489,-0.006047,0.046355,0.020927,-0.013938,-0.036296,-0.017420,-0.015890,0.024451,-0.016271,0.001225,0.012275,-0.003633,0.022896,0.025973,-0.000284,0.037918,-0.022102,0.008735,0.008454,0.005153,-0.008644,0.011200,0.011208,0.021010,0.034311,-0.007746,-0.002291,0.009364,0.025146,-0.000720,0.022780,0.035469,0.019075,-0.001049,0.001368,-0.000878,0.023326,0.032706,0.003900,-0.008677,-0.050259,0.055454,0.009943,0.041789,0.045528,-0.000464,0.015361,-0.027396,0.013078,0.005352,-0.012292,-0.024005,0.008015,-0.005261,0.030969,-0.003253,0.017271,0.000539,-0.026652,-0.022847,-0.020249,0.002608,0.015443,-0.014997,-0.010944,0.008933,0.035304,0.034543,-0.008933,0.017387,-0.003220,0.038248,-0.026238,0.014649,0.009926,0.015055,-0.019356,-0.019455,-0.000882,-0.019604,-0.049697,-0.038778,0.011473,-0.034212,-0.005224,0.027628,0.006084,-0.006038,0.001493,0.030969,-0.001246,0.065711,0.005517,-0.018181,0.019538,0.005819,-0.003410,-0.003265,0.030523,-0.023492,0.003056,-0.025278,-0.018181,0.026701,0.017685,0.035568,-0.005075,-0.019008,-0.011043,0.026486,-0.012614,-0.015005,0.005348,0.014964,0.000456,-0.010422,-0.006622,-0.044998,0.017106,0.014335,-0.029911,0.018314,0.038348,-0.006514,0.000850,-0.011283,-0.000236,-0.004454,0.004793,-0.009198,0.040565,0.003201,0.019571,-0.017520,-0.014682,0.005232,-0.000616,-0.030208,0.014972,-0.009769,-0.020828,-0.012399,-0.012399,0.000777,0.010919,-0.015237,0.017536,0.013607,0.011059,0.008652,-0.023227,-0.005451,-0.009612,0.013913,0.006547,-0.008611,0.002471,-0.034973,0.036925,0.019654,0.014674,0.020315,0.002955,-0.023723,0.021606,0.010836,-0.028637,-0.028769,0.007403,-0.020464,-0.010042,-0.007544,-0.012052,0.009736,0.009587,-0.015625,0.036296,-0.000528,-0.023426,-0.001331,-0.035370,0.011944,0.024203,-0.035337,0.000321,0.017619,0.006440,0.000871,0.015890,0.022449,0.009231,-0.012317,0.008127,0.036164,0.018909,0.005219,0.002684,-0.035304,0.004926,0.002215,0.031664,-0.005985,-0.006076,-0.012556,-0.011299,-0.021523,0.006307,-0.007556,-0.000053,-0.010398,0.144391,-0.011117,-0.021440,0.015253,0.010001,0.005397,-0.025063,0.032227,0.004289,0.005087,-0.056876,-0.017950,0.017139,0.022284,-0.018479,0.000385,-0.014707,-0.071269,-0.010894,-0.039307,0.028604,-0.045296,0.012052,0.016502,0.009637,-0.016568,0.007068,0.006435,0.013715,0.000881,0.048902,-0.023095,-0.016850,-0.027595,0.019803,-0.026271,-0.023128,-0.023558,-0.015385,-0.023839,-0.037421,0.000823,-0.003189,-0.009744,-0.002653,0.019455,0.008818,-0.005017,-0.013640,0.003501,-0.008201,-0.000048,-0.010968,0.010671,-0.014145,-0.007163,-0.018727,0.001208,0.073188,0.029662,-0.029944,-0.007449,0.031532,-0.001835,-0.026635,-0.038381,-0.031085,-0.006791,-0.009124,-0.007850,-0.008958,-0.018297,0.003464,-0.006675,-0.022036,0.002163,0.028620,0.042980,-0.040829,0.026470,0.012854,0.021722,0.040201,0.038480,-0.042484,0.008727,0.014029,-0.021440,-0.014542,-0.008197,0.009943,-0.000775,0.007292,-0.020117,0.015716,0.000056,-0.010455,-0.011647,0.007196,-0.032624,0.012085,-0.044634,0.003344,0.000831,-0.014442,-0.008503,-0.002806,0.004731,-0.007035,0.012159,0.010464,-0.021027,-0.022334,-0.011514,0.010960,-0.018810,-0.002974,0.006092,-0.005803,-0.017156,0.008119,0.014666,0.005368,-0.008330,0.021688,-0.030473,0.015013,0.014881,0.007560,-0.035304,0.003666,-0.011787,0.011498,0.004864,0.002949,0.022400,-0.029778,-0.011920,0.037620,-0.008007,0.001938,-0.004463,0.014757,-0.002175,0.044866,0.009074,-0.002043,0.000500,-0.018347,-0.005141,-0.042484,-0.026916,-0.022069,-0.006423,0.014277,-0.005732,-0.015493,-0.022383,0.010480,-0.010795,-0.037124,0.001454,-0.014699,-0.004467,0.044436,-0.037157,0.010819,0.009165,-0.001278,-0.002184,0.020034,0.001265,0.009463,-0.000147,0.018314,0.008991,-0.025444,0.003447,-0.011523,-0.006708,0.016436,-0.040995,-0.016188,-0.014252,-0.050259,0.031780,-0.025411,-0.002852,0.040598,-0.016411,0.032227,0.000743,0.020166,0.007316,-0.047778,0.032673,-0.004392,0.017040,-0.045428,0.009703,0.022350,-0.039440,0.010695,0.034046,0.012077,-0.021076,0.013351,0.003489,-0.012333,-0.003542,-0.006911,-0.009099,-0.000482,0.052641,0.012408,0.038182,0.022631,0.004847,-0.031747,0.030142,-0.023492,-0.007010,-0.018826,0.012838,-0.007833,0.024435,-0.003410,-0.004864,-0.038612,-0.032177,-0.019869,-0.000453,-0.024948,0.013880,0.017205,-0.009529,0.009463,-0.007655,-0.013260,0.004347,-0.020597,0.000908,-0.017023,-0.026718,-0.030705,0.030308,0.021523,-0.007130,0.023442,-0.000317,0.004252,-0.000905,-0.004611,0.002527,-0.029398,-0.041359,0.019372,-0.012358,0.034146,-0.037024,-0.003391,-0.014376,0.009579,-0.029762,0.011374,-0.012937,0.012722,-0.007370,0.003902,0.013913,0.004148,-0.004070,-0.042252,0.047546,0.008458,0.035006,-0.028256,0.025113,0.043575,-0.022681,-0.006559,0.000033,-0.013251,-0.042384,0.001292,0.001165,-0.007188,0.008545,0.020448,-0.021242,0.006154,-0.007937,0.011324,-0.009744,0.005852,-0.024914,0.015559,-0.030175,0.010811,0.024385,-0.011150,0.012821,-0.020249,-0.019439,0.026188,-0.046421,0.009959,-0.026106,0.040465,-0.004545,0.013045,0.012631,0.008057,0.021970,0.024551,-0.011523,0.017619,0.007002,-0.012763,-0.000984,0.019141,-0.004930,-0.027197,-0.002368,0.031763,0.010406,-0.008301,-0.001935,0.021358,0.026602,0.012068,-0.047943,0.000458,-0.005315,-0.001197,-0.013003,-0.004450,0.020464,0.016122,-0.008776,-0.019455,0.045892,0.022880,0.041987,0.007610,0.027644,0.050722,0.002084,-0.011117,0.005397,0.000879,-0.022913,0.015203,-0.007767,0.025196,-0.023806,0.021937,0.013260,0.012606,0.002382,0.006175,0.016734,-0.026949,-0.032657,0.010224,0.031681,0.020266,-0.007498,0.007275,0.004454,-0.054726,-0.023326,0.023773,-0.008892,0.000087,0.002178,-0.001952,-0.023790,-0.035602,-0.024170,0.010058,-0.017387,0.006613,-0.024749,0.018115,0.003456,0.007986,-0.020282,-0.012962]::vector ASC,
         e.created_at DESC
LIMIT 1;

### SQL (fts+trgm, caption) ###
SELECT
  e.id,
  e.title,
  concat('https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/', e.storage_path) AS imageUrl
FROM eagle_images e
CROSS JOIN LATERAL (
  SELECT
    setweight(to_tsvector('english', unaccent(coalesce(e.caption,''))), 'A') || setweight(to_tsvector('simple',  unaccent(array_to_string(e.tags,' '))), 'B') || setweight(to_tsvector('simple',  unaccent(coalesce(e.title,''))), 'C') AS tsv,
    websearch_to_tsquery('english', unaccent('crt')) AS q_web,
    plainto_tsquery('simple',  unaccent('crt'))       AS q_plain,
    similarity(unaccent(coalesce(e.caption,'')), unaccent('crt')) AS cap_sim,
    similarity(unaccent(coalesce(e.title,'')),   unaccent('crt')) AS title_sim,
    (SELECT max(similarity(unaccent(tag), unaccent('crt'))) FROM unnest(e.tags) AS tag) AS tag_sim
) s
ORDER BY
  (0.9*COALESCE(ts_rank_cd(s.tsv, s.q_web), 0) + 0.8*COALESCE(ts_rank_cd(s.tsv, s.q_plain), 0)) +
  (0.8*COALESCE(s.cap_sim,0) + 0.6*COALESCE(s.tag_sim,0) + 0.4*COALESCE(s.title_sim,0)) +
  (0.05 * (extract(epoch from (now() - e.created_at)) * -1.0 / 86400.0)) +
  (0.02*random()) DESC,
  e.created_at DESC
LIMIT 1;

### Discord Post ###
Channel: lucid
Media: https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO254IS16AWXP.jpg
Args: {"channel": "lucid", "message": "", "mediaUrl": "https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO254IS16AWXP.jpg", "imageUrl": "https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO254IS16AWXP.jpg"}
Result: {"content": [{"type": "text", "text": "Message sent successfully to #lucid in dreamsim.exe. Message ID: 1416051192873619556", "annotations": null, "_meta": null}], "isError": false, "model": null}
