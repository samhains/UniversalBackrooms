
### SQL (semantic) ###
SELECT
  e.id,
  e.title,
  concat('https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/', e.storage_path) AS imageUrl
FROM eagle_images e
ORDER BY e.caption_embedding <-> [0.021219,0.009299,0.004587,-0.008765,-0.004778,-0.012954,0.015740,0.068385,-0.031585,0.039645,-0.020745,0.041331,-0.008173,0.002287,-0.032296,-0.019770,0.017070,-0.006181,-0.005762,0.028423,0.012829,-0.037433,-0.033824,-0.005532,-0.027976,0.009892,0.007705,0.057110,0.024999,0.012519,0.020389,-0.041015,0.010827,0.011946,0.030241,-0.029688,-0.006770,-0.026751,-0.024103,0.014581,0.015911,-0.022272,-0.026198,0.031031,0.076656,0.018005,0.006665,-0.038908,0.052843,0.039751,-0.016174,-0.013230,-0.031585,-0.000262,-0.010932,0.077341,-0.005305,0.030425,-0.013935,0.006190,-0.004475,0.032190,0.011920,-0.006569,0.030952,0.018980,-0.037116,-0.024406,0.001801,0.021377,-0.029820,0.023050,-0.043386,-0.019638,0.021732,0.010293,0.004531,-0.029899,-0.002863,-0.038196,0.029872,0.030452,-0.037459,-0.011426,-0.010234,-0.023774,-0.036326,0.018453,-0.015555,-0.000440,0.019507,0.002858,-0.045414,0.029741,-0.048839,0.007132,-0.046099,-0.014976,0.008423,0.009984,-0.006240,-0.058059,-0.001200,0.028134,0.000484,0.024894,-0.009608,-0.002144,-0.031664,0.008950,-0.062115,-0.026382,0.030346,0.017136,0.034640,0.015990,0.077552,-0.030162,0.045335,-0.018795,-0.000098,-0.021746,-0.003057,0.015503,0.024261,0.005348,-0.013803,0.017544,0.031664,-0.026408,0.014027,0.029082,0.017992,-0.023076,-0.017004,-0.001806,-0.027791,0.005018,-0.027528,-0.019006,0.011650,0.042543,-0.001190,-0.017636,0.016201,-0.002759,0.005581,0.018321,0.008324,0.032059,0.024195,-0.011169,-0.042806,0.035562,-0.008706,-0.017505,0.027475,0.004649,-0.011130,0.030952,-0.038196,-0.057584,0.038960,-0.019454,0.037907,-0.038223,-0.039909,0.028529,-0.059218,0.055161,-0.017465,0.017096,0.020468,0.032322,0.000915,0.000586,0.008278,-0.003612,0.013593,0.011433,0.014093,0.056636,-0.018571,0.029503,0.004649,0.004758,0.016872,0.010056,0.037143,0.023129,-0.003803,0.037775,0.036879,0.024419,0.013230,-0.060324,0.016793,0.006750,-0.033112,0.028582,-0.038697,0.015371,-0.000972,-0.041700,0.010162,0.031532,-0.068596,0.009365,-0.005374,0.000821,0.065118,0.013013,-0.002827,-0.010609,0.027396,0.010623,0.064012,0.009582,-0.019072,0.017886,0.003051,-0.011327,0.038355,0.030531,0.012150,0.054318,0.004109,-0.051183,0.010873,0.012420,0.040910,0.023445,-0.029530,-0.009259,-0.030768,0.027106,-0.042517,-0.013257,-0.020376,0.004719,-0.013672,0.025776,-0.013738,0.012315,0.034482,0.021298,0.053818,0.026817,0.010965,-0.021732,0.057953,0.026066,-0.033086,-0.068543,-0.005901,0.001783,-0.040515,0.018255,0.005509,-0.029161,-0.006197,-0.005802,-0.014976,-0.035299,0.029187,-0.043333,0.000810,-0.025197,0.007580,-0.040883,0.001585,0.020666,0.012368,-0.008700,-0.010741,0.026105,0.065961,0.005476,-0.008733,0.034588,0.025078,0.021048,-0.002725,-0.039118,-0.030162,-0.008430,0.038276,-0.019217,0.056373,0.037064,0.017610,-0.000308,0.013086,0.013000,-0.035773,-0.043676,-0.011927,-0.007685,-0.009299,-0.042991,0.021956,-0.012849,-0.034877,0.049208,-0.022483,0.025539,0.000250,-0.042569,0.021482,0.020560,-0.016411,-0.014475,0.034245,-0.001583,0.009161,-0.033929,-0.003826,0.022167,0.023405,0.034245,0.006842,-0.026777,0.044966,0.018374,0.000259,-0.056847,-0.003089,-0.020797,0.038196,0.019691,-0.031664,0.005591,0.012769,-0.008858,0.040225,-0.046889,0.004149,-0.004225,-0.036458,0.001608,-0.020218,-0.069755,-0.023972,-0.008877,-0.049050,0.010497,0.057163,-0.019770,0.044229,0.032744,0.054845,0.064486,-0.013553,0.001303,-0.022918,-0.034377,0.059587,0.018374,-0.029135,0.040804,-0.025368,0.019414,0.013896,-0.019151,0.003596,-0.013250,-0.052026,0.002848,0.066857,-0.025921,-0.045678,-0.006167,-0.006230,-0.032928,-0.005213,0.004271,0.046784,0.030584,-0.002982,0.038276,-0.041832,0.063959,0.018466,0.020547,0.002707,0.013817,-0.026738,-0.022852,0.014370,-0.052342,0.064960,-0.039882,0.039935,-0.019204,0.045572,-0.014949,0.035220,-0.021640,0.000647,0.032348,-0.028107,-0.012328,-0.046415,0.053185,0.021337,0.081398,0.012453,-0.048180,0.003309,-0.062748,0.003895,-0.090354,0.028423,0.022404,0.005222,0.013856,-0.009938,-0.029214,-0.022049,0.019586,0.027264,0.043491,-0.022615,0.021812,-0.007850,0.108952,0.043913,-0.029899,0.017702,-0.046889,0.021495,-0.026303,0.014172,0.047996,0.010076,0.035062,0.011657,-0.002264,-0.013922,0.013738,0.081345,0.025104,-0.003790,0.031321,-0.026250,0.021179,0.033349,-0.008502,-0.022483,-0.005578,-0.007033,-0.019507,-0.038407,-0.024920,0.025210,0.033033,0.012868,0.050340,0.008844,-0.021812,0.014040,0.008594,-0.056162,0.010129,0.040383,-0.046758,0.016648,0.029872,0.007073,-0.045072,-0.030847,-0.031795,0.016187,-0.024933,-0.002814,-0.002435,-0.000323,-0.027976,0.029082,0.015568,-0.017913,0.008792,-0.025816,-0.011610,-0.000110,0.040436,0.043491,0.006915,-0.065803,0.016016,-0.013250,0.033402,0.000799,-0.014080,0.034930,-0.037143,-0.074286,0.019638,0.007547,-0.002198,0.013158,-0.006144,-0.034772,-0.025921,-0.007521,0.012908,-0.023787,0.012842,0.038065,0.000658,0.021140,0.014923,-0.039514,-0.002104,-0.007178,0.014897,-0.029688,0.007494,0.001475,-0.041279,0.038065,0.003925,-0.040515,0.001551,0.021087,-0.040014,-0.004633,-0.050498,-0.002570,-0.019651,-0.013138,0.012730,0.027633,0.001044,-0.027976,-0.005031,-0.006569,-0.014962,-0.000640,0.023761,-0.017702,0.022378,-0.011591,-0.010399,-0.043412,0.054002,-0.030109,0.007132,0.000785,0.007185,0.019269,-0.009457,0.006783,-0.028950,-0.005213,-0.012901,0.022707,0.009753,0.003517,0.024419,-0.032085,0.027185,-0.005097,-0.024169,0.000899,0.026830,-0.022391,0.003461,-0.010616,-0.012038,0.032665,-0.001616,-0.038565,-0.070282,0.031874,0.003645,0.009332,-0.036089,0.003115,-0.009075,0.012835,-0.054371,-0.027580,-0.006681,-0.016872,-0.027001,-0.011841,-0.027580,0.005703,-0.011867,0.004442,-0.022193,0.002130,-0.032665,-0.032559,-0.004060,-0.020626,-0.012710,-0.014870,0.022220,-0.027870,0.012526,0.015647,-0.002078,0.015845,-0.027949,-0.008133,0.007936,0.018611,-0.024498,-0.029293,-0.036379,0.037380,-0.004626,-0.027422,-0.006737,-0.020810,-0.004620,-0.003392,0.002053,-0.028213,-0.009727,0.005697,-0.007066,-0.001911,0.000482,-0.022022,0.022984,-0.041805,-0.034166,-0.006316,0.015674,-0.003932,-0.020442,-0.012585,-0.019467,-0.000260,0.004735,0.022431,-0.003107,0.070334,0.012341,0.002228,-0.069597,0.017149,0.012677,0.010899,-0.006543,0.000886,-0.000932,0.008028,0.005980,-0.020508,-0.018084,-0.031585,0.008225,0.001608,-0.062221,-0.008397,0.013975,-0.007666,0.025355,0.030979,-0.007606,-0.044993,0.072600,-0.016754,-0.010254,-0.000753,0.013382,0.073759,0.008351,-0.016332,-0.016187,0.042938,-0.027949,0.000813,-0.039145,0.009273,-0.001828,0.012598,-0.004146,-0.003741,-0.017162,-0.027791,0.018150,0.014699,-0.002802,-0.040883,-0.009536,-0.046705,0.004419,0.005466,-0.006941,-0.002239,-0.009292,0.013869,0.020284,-0.033982,-0.033007,-0.015819,0.010702,-0.013738,0.000865,-0.027343,0.020060,0.015819,0.013803,0.048733,-0.002740,-0.004215,-0.005993,-0.047917,0.069807,-0.011255,0.013421,0.011439,-0.011228,0.002781,-0.000924,0.006388,0.031980,-0.007639,-0.019796,-0.043096,0.007547,0.002939,-0.041516,-0.039487,0.013751,-0.012486,0.020363,0.020679,0.032559,-0.007099,0.000310,-0.018624,0.001895,0.012243,-0.010774,-0.018031,-0.015173,-0.034904,-0.009503,-0.048154,0.024261,-0.021034,-0.030584,-0.032902,0.030267,0.011314,0.009911,0.006553,-0.000458,-0.009055,-0.023985,0.021996,-0.045493,-0.000198,0.018005,0.006141,0.039961,0.029925,-0.008370,0.001200,0.031321,-0.005410,0.009674,-0.027159,0.002980,0.012862,-0.068279,0.006777,-0.002786,-0.003895,0.010425,-0.004093,0.058006,0.007699,0.004831,0.007350,-0.010135,-0.045836,0.045757,-0.013283,-0.014818,-0.006171,-0.019507,-0.001216,0.011367,0.016899,0.011446,0.014172,0.012348,0.033244,0.021127,0.012671,-0.020284,-0.002549,-0.024538,0.033060,0.015226,0.031637,-0.005828,0.006816,0.045493,-0.008219,0.017017,0.004106,0.010043,-0.016583,0.022062,-0.009589,0.023050,0.006921,-0.007264,0.006915,-0.004528,0.008989,-0.009207,0.044387,0.013500,-0.011808,0.011933,-0.054002,-0.008864,0.057110,0.024986,-0.010827,-0.034535,0.002939,-0.019678,0.001397,0.009872,-0.012223,0.007257,0.011782,-0.032480,-0.002993,0.032586,0.025381,0.039988,0.009622,-0.024222,-0.010682,-0.033797,-0.013672,0.020810,-0.000845,0.015805,-0.044519,-0.022128,0.063432,0.004063,0.010879,-0.008489,-0.003010,-0.006829,0.012559,-0.021864,-0.022049,0.038486,0.013066,-0.024828,0.000234,0.007218,-0.024696,0.014699,-0.017491,0.009424,0.034640,0.022602,0.009431,0.033139,0.023866,0.035905,-0.053133,0.026843,-0.015463,-0.019480,-0.015766,0.014515,0.043728,-0.001260,-0.015226,-0.040962,-0.015489,0.061483,0.029688,0.023353,-0.013566,-0.000971,0.000550,-0.075234,0.016714,0.002937,-0.004304,0.024617,0.026830,-0.034113,-0.003401,-0.014581,-0.006655,0.000368,0.051341,0.043043,-0.001001,0.024999,0.004817,0.005552,-0.044650,-0.012256,0.007066,-0.022391,0.014054,0.000640,0.002244,-0.016965,-0.030215,0.005341,0.003592,0.017044,0.010688,-0.002351,0.001404,0.005706,-0.003085,0.005581,0.000974,0.001359,0.053080,0.019362,0.012374,0.051736,0.017017,-0.027291,0.013659,-0.022101,0.000216,-0.011156,0.068596,-0.026250,-0.014712,0.024828,0.015055,-0.009931,0.018782,-0.016556,-0.016951,-0.040673,0.030847,-0.021891,0.042938,-0.012835,0.005999,-0.047258,-0.022233,0.021996,-0.000502,0.018822,-0.005720,-0.007086,-0.001039,-0.015476,-0.009885,-0.003444,-0.009977,-0.009971,0.013125,-0.024143,-0.048233,-0.039619,0.047548,0.006592,-0.002498,0.019480,-0.011498,-0.021759,0.042648,0.015674,0.033929,0.052579,-0.005153,-0.013909,0.006675,0.002679,0.033771,0.005295,-0.031005,-0.009338,-0.003392,-0.006079,-0.015990,-0.007679,-0.008252,0.021838,0.025895,-0.031058,0.035062,0.045204,-0.004465,-0.010181,0.007185,0.007040,-0.016411,-0.006961,0.012467,0.034008,-0.007527,-0.022417,-0.036958,-0.008528,0.029240,-0.013830,-0.032480,-0.023405,0.035905,-0.009147,-0.023129,-0.000499,-0.044624,-0.001631,0.013441,0.010688,-0.002093,-0.045019,0.017136,-0.028529,0.018716,-0.019467,-0.022826,-0.037828,-0.011498,-0.004165,0.011683,0.038407,-0.002723,-0.023616,-0.032665,-0.006721,-0.008443,0.003576,0.020218,-0.015384,-0.032586,-0.022483,-0.032454,-0.023761,0.003350,0.018729,-0.029846,-0.037775,-0.006619,-0.006829,-0.004021,-0.014436,0.035799,-0.033191,-0.016938,0.006902,-0.021983,-0.007007,-0.013764,-0.001967,0.008805,-0.007890,-0.042964,0.034377,0.014778,-0.014752,0.011070,-0.012085,-0.025091,0.027396,-0.005282,-0.035088,-0.011215,0.009022,-0.009358,0.008298,0.004847,-0.007692,0.027370,0.052079,-0.038881,-0.030979,0.033033,-0.003028,0.000027,-0.007942,-0.017610,0.035852,-0.005400,-0.000167,-0.025183,0.020244,0.034983,0.025895,0.018677,0.018822,0.009108,-0.009174,0.024116,-0.006730,-0.034561,0.010412,0.005239,-0.012941,0.017531,-0.006948,0.002843,-0.008153,0.023036,0.012717,-0.006694,-0.012552,-0.035220,-0.023827,-0.031400,0.035615,-0.015002,-0.012157,-0.000265,0.024037,0.002544,-0.017465,0.053054,-0.015805,-0.010115,-0.037696,-0.022694,0.045967,0.024077,0.024340,0.000903,0.006144,0.016332,-0.015397,-0.013935,0.023827,-0.011123,0.037696,0.002549,0.012394,0.008601,0.026000,-0.003853,0.102419,-0.004198,-0.026171,-0.018466,0.005848,-0.018466,-0.001203,0.003889,-0.000988,0.036616,-0.011907,-0.024604,0.018492,-0.012947,0.010767,-0.008818,0.016806,-0.000543,-0.004992,-0.006829,-0.005631,-0.006849,0.019757,0.011525,-0.011479,0.024617,-0.004893,-0.025078,0.019520,0.001138,0.043386,-0.005492,0.015371,0.005321,0.000939,-0.014251,0.013000,-0.020890,0.004732,-0.000574,-0.000420,0.009668,-0.017123,-0.012236,0.045072,-0.003994,0.009141,-0.006484,-0.007692,0.046205,0.027054,0.023721,-0.003431,0.012895,-0.007007,-0.042991,0.010175,0.021548,0.034219,-0.020771,-0.008173,-0.032243,0.033692,-0.007126,0.006632,-0.015608,-0.000006,0.016003,0.008528,0.018295,0.015094,0.030821,0.015397,-0.041279,0.005150,0.005604,0.038038,0.002489,-0.040541,0.033218,-0.012440,0.001448,0.031532,0.000754,0.008232,0.017781,-0.029029,-0.020942,-0.021087,-0.015884,0.023497,-0.009957,0.008963,0.006648,-0.006915,0.014172,0.014910,0.012032,-0.011505,0.007185,0.001436,-0.031585,-0.018585,0.003138,0.016187,0.016359,0.001474,0.017689,-0.017136,-0.007145,-0.001599,-0.004962,0.025289,-0.006704,0.023774,0.016622,-0.016859,0.005822,-0.019559,0.014357,0.006283,-0.020402,0.001672,-0.038407,0.017584,0.000536,-0.024512,0.022101,-0.011742,-0.005446,0.037617,0.017030,0.013896,-0.003141,-0.029424,0.020534,0.005367,-0.011255,-0.008489,0.003507,0.057584,0.039092,0.020547,-0.019625,0.016530,-0.007758,0.050446,0.007185,0.002773,-0.015924,0.002619,0.009964,-0.003662,0.024419,-0.003961,0.003415,-0.015871,0.014831,-0.022391,-0.020758,0.010576,0.022431,-0.009279,0.006447,0.025381,-0.002565,-0.013046,0.042385,-0.037222,-0.011393,0.018874,-0.018453,-0.042227,0.003079,0.020152,0.002277,-0.003928,0.002735,-0.056373,0.015753,-0.002086,-0.001031,0.022246,0.025460,-0.024248,0.046995,0.018532,0.010886,0.042359,0.000383,0.013198,-0.017886,0.022035,-0.001974,-0.030320,0.007382,-0.041305,0.032401,0.013092,-0.015832,-0.014673,-0.008390,-0.002282,0.047706,0.043676,-0.027686,0.014370,0.005588,0.013145,-0.008627,0.019533,-0.012302,0.001446,-0.006138,-0.015963,0.046652,0.031216,0.018203,-0.044413,0.009088,0.004574,-0.017794,0.015384,-0.021061,-0.036010,0.000091,0.035167,0.012118,-0.005713,-0.039461,0.027712,0.043123,0.000687,-0.007271,0.024248,0.035378,-0.017294,0.040198,-0.035404,-0.000015,0.018506,-0.005143,-0.007778,-0.000248,0.002056,0.024261,0.040646,-0.007699,-0.009523,0.034271,-0.045493,0.006836,0.015740,-0.046916,-0.005562,-0.006144,0.029214,-0.000043,0.015121,-0.013961,0.003652,-0.006763,-0.004768,-0.014304,-0.014238,-0.010583,-0.017584,0.024156,0.000547,0.031400,0.048654,-0.013303,0.001621,-0.008970,-0.036511,0.036669,0.013869,0.037749,-0.000675,-0.033850,-0.025052,0.000871,-0.019335,-0.028634,-0.016833,0.031822,-0.020350,0.013777,0.019059,-0.041200,0.032507,-0.013803,0.023023,-0.001767,0.038855,0.011564,0.007527,-0.017755,-0.021719,-0.009167,0.033613,0.016872,-0.003849,0.001972,0.017017,-0.011360,0.020600,0.031980,0.021245,-0.035852,0.028924,0.013593,-0.028582,-0.028134,0.026277,0.046205,-0.000877,0.013830,-0.015674,0.035562,0.039751,0.003941,-0.026922,-0.034825,-0.036063,-0.038618,0.008331,-0.019520,0.027343,0.001157,0.009431,-0.003527,-0.007521,0.004080,-0.022431,-0.030399,-0.024340,0.008792,-0.016938,-0.034798,-0.012269,0.024169,-0.006961,0.022259,0.000579,-0.026738,-0.010537,-0.026487,-0.004287,-0.013026,-0.041252,-0.007376,-0.029108,-0.020692,-0.020310,-0.003118,0.016938,0.015911,-0.043728,0.030979,-0.000798,0.038302,0.025486,0.002252,-0.001567,0.008456,0.011953,0.014225,-0.005268,-0.006638,-0.019862,0.001161,0.004409,0.031163,0.010991,-0.007303,-0.016543,-0.011097,-0.018295,0.016583,-0.008937,0.014976,-0.030873,0.003171,-0.028134,0.028292,-0.004903,0.009338,-0.005604]::vector ASC,
         e.created_at DESC
LIMIT 1;

### SQL (fts+trgm, caption) ###
SELECT
  e.id,
  e.title,
  concat('https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/', e.storage_path) AS imageUrl
FROM eagle_images e
CROSS JOIN LATERAL (
  SELECT
    setweight(to_tsvector('english', unaccent(coalesce(e.caption,''))), 'A') || setweight(to_tsvector('simple',  unaccent(array_to_string(e.tags,' '))), 'B') || setweight(to_tsvector('simple',  unaccent(coalesce(e.title,''))), 'C') AS tsv,
    websearch_to_tsquery('english', unaccent('rainforest')) AS q_web,
    plainto_tsquery('simple',  unaccent('rainforest'))       AS q_plain,
    similarity(unaccent(coalesce(e.caption,'')), unaccent('rainforest')) AS cap_sim,
    similarity(unaccent(coalesce(e.title,'')),   unaccent('rainforest')) AS title_sim,
    (SELECT max(similarity(unaccent(tag), unaccent('rainforest'))) FROM unnest(e.tags) AS tag) AS tag_sim
) s
ORDER BY
  (0.9*COALESCE(ts_rank_cd(s.tsv, s.q_web), 0) + 0.8*COALESCE(ts_rank_cd(s.tsv, s.q_plain), 0)) +
  (0.8*COALESCE(s.cap_sim,0) + 0.6*COALESCE(s.tag_sim,0) + 0.4*COALESCE(s.title_sim,0)) +
  (0.05 * (extract(epoch from (now() - e.created_at)) * -1.0 / 86400.0)) +
  (0.02*random()) DESC,
  e.created_at DESC
LIMIT 1;

### Discord Post ###
Channel: lucid
Media: https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO251FOAKWC8V.jpg
Args: {"channel": "lucid", "message": "", "mediaUrl": "https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO251FOAKWC8V.jpg", "imageUrl": "https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO251FOAKWC8V.jpg"}
Result: {"content": [{"type": "text", "text": "Message sent successfully to #lucid in dreamsim.exe. Message ID: 1416051098191659028", "annotations": null, "_meta": null}], "isError": false, "model": null}
