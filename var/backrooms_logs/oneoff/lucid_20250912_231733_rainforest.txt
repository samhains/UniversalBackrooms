
### SQL (semantic) ###
SELECT
  e.id,
  e.title,
  concat('https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/', e.storage_path) AS imageUrl
FROM eagle_images e
ORDER BY e.caption_embedding <-> [0.021198,0.009288,0.004595,-0.008827,-0.004776,-0.012937,0.015730,0.068402,-0.031619,0.039682,-0.020697,0.041368,-0.008181,0.002274,-0.032278,-0.019775,0.017035,-0.006202,-0.005810,0.028431,0.012832,-0.037363,-0.033858,-0.005606,-0.027983,0.009894,0.007674,0.057177,0.025071,0.012450,0.020447,-0.040946,0.010803,0.011956,0.030196,-0.029695,-0.006772,-0.026757,-0.024057,0.014597,0.015941,-0.022252,-0.026204,0.031092,0.076623,0.017996,0.006600,-0.038865,0.052777,0.039787,-0.016178,-0.013240,-0.031592,-0.000236,-0.010968,0.077308,-0.005290,0.030459,-0.013978,0.006172,-0.004516,0.032146,0.011883,-0.006620,0.030960,0.019024,-0.037073,-0.024399,0.001749,0.021343,-0.029827,0.023042,-0.043344,-0.019683,0.021751,0.010316,0.004516,-0.029827,-0.002842,-0.038206,0.029827,0.030459,-0.037416,-0.011435,-0.010210,-0.023727,-0.036335,0.018392,-0.015506,-0.000457,0.019511,0.002841,-0.045373,0.029695,-0.048825,0.007094,-0.046058,-0.014993,0.008405,0.009980,-0.006228,-0.058126,-0.001191,0.028088,0.000523,0.024887,-0.009552,-0.002129,-0.031645,0.008998,-0.062078,-0.026402,0.030328,0.017166,0.034675,0.016007,0.077571,-0.030196,0.045373,-0.018826,-0.000141,-0.021738,-0.003037,0.015454,0.024267,0.005385,-0.013767,0.017575,0.031672,-0.026441,0.014084,0.029089,0.017944,-0.023082,-0.017035,-0.001787,-0.027825,0.005072,-0.027508,-0.019037,0.011620,0.042501,-0.001187,-0.017601,0.016244,-0.002800,0.005570,0.018352,0.008287,0.032067,0.024241,-0.011139,-0.042764,0.035571,-0.008708,-0.017522,0.027508,0.004660,-0.011119,0.030934,-0.038232,-0.057494,0.038917,-0.019459,0.037916,-0.038232,-0.039945,0.028510,-0.059233,0.055228,-0.017469,0.017127,0.020486,0.032357,0.000867,0.000602,0.008208,-0.003620,0.013649,0.011416,0.014097,0.056598,-0.018576,0.029511,0.004674,0.004796,0.016824,0.010013,0.037152,0.023121,-0.003738,0.037837,0.036862,0.024386,0.013188,-0.060234,0.016811,0.006732,-0.033068,0.028562,-0.038812,0.015348,-0.000915,-0.041710,0.010138,0.031566,-0.068613,0.009407,-0.005372,0.000907,0.065029,0.012983,-0.002826,-0.010652,0.027429,0.010665,0.063975,0.009584,-0.019103,0.017944,0.003076,-0.011323,0.038338,0.030565,0.012167,0.054332,0.004084,-0.051196,0.010895,0.012391,0.040867,0.023530,-0.029485,-0.009314,-0.030776,0.027139,-0.042527,-0.013240,-0.020328,0.004743,-0.013636,0.025743,-0.013781,0.012226,0.034438,0.021316,0.053831,0.026797,0.010968,-0.021712,0.057862,0.026020,-0.033068,-0.068507,-0.005879,0.001777,-0.040498,0.018260,0.005553,-0.029142,-0.006241,-0.005863,-0.014966,-0.035255,0.029116,-0.043291,0.000823,-0.025137,0.007529,-0.040920,0.001566,0.020631,0.012397,-0.008722,-0.010777,0.026099,0.065978,0.005507,-0.008682,0.034623,0.025111,0.021027,-0.002729,-0.039155,-0.030196,-0.008399,0.038338,-0.019208,0.056334,0.037047,0.017627,-0.000295,0.013049,0.012997,-0.035729,-0.043634,-0.011897,-0.007595,-0.009268,-0.042923,0.021949,-0.012858,-0.034939,0.049167,-0.022502,0.025506,0.000191,-0.042554,0.021448,0.020579,-0.016389,-0.014492,0.034201,-0.001574,0.009196,-0.033964,-0.003788,0.022199,0.023411,0.034280,0.006791,-0.026797,0.045030,0.018378,0.000220,-0.056914,-0.003055,-0.020842,0.038206,0.019749,-0.031672,0.005596,0.012779,-0.008886,0.040235,-0.046928,0.004173,-0.004157,-0.036388,0.001569,-0.020223,-0.069667,-0.023912,-0.008840,-0.049115,0.010520,0.057177,-0.019801,0.044214,0.032805,0.054859,0.064450,-0.013530,0.001317,-0.022937,-0.034412,0.059707,0.018392,-0.029195,0.040815,-0.025282,0.019459,0.013899,-0.019143,0.003557,-0.013221,-0.052092,0.002837,0.066979,-0.025914,-0.045689,-0.006162,-0.006278,-0.032884,-0.005237,0.004318,0.046769,0.030591,-0.002966,0.038285,-0.041869,0.064028,0.018418,0.020526,0.002679,0.013820,-0.026678,-0.022818,0.014308,-0.052303,0.064924,-0.039866,0.039919,-0.019301,0.045610,-0.014940,0.035281,-0.021685,0.000676,0.032357,-0.028141,-0.012358,-0.046401,0.053251,0.021369,0.081418,0.012410,-0.048192,0.003264,-0.062711,0.003837,-0.090324,0.028457,0.022463,0.005240,0.013741,-0.009953,-0.029221,-0.022080,0.019538,0.027219,0.043502,-0.022568,0.021777,-0.007852,0.108874,0.043924,-0.029906,0.017746,-0.046928,0.021501,-0.026336,0.014084,0.048034,0.010078,0.035176,0.011679,-0.002279,-0.013952,0.013675,0.081366,0.025111,-0.003765,0.031303,-0.026191,0.021211,0.033384,-0.008419,-0.022489,-0.005622,-0.007081,-0.019472,-0.038496,-0.024900,0.025190,0.033042,0.012871,0.050406,0.008827,-0.021804,0.014044,0.008570,-0.056071,0.010138,0.040314,-0.046769,0.016692,0.029906,0.007075,-0.045057,-0.030776,-0.031777,0.016112,-0.024926,-0.002772,-0.002411,-0.000353,-0.027904,0.029142,0.015520,-0.017838,0.008735,-0.025862,-0.011607,-0.000098,0.040446,0.043502,0.006956,-0.065820,0.016033,-0.013352,0.033437,0.000812,-0.014070,0.034886,-0.037178,-0.074252,0.019564,0.007529,-0.002195,0.013155,-0.006182,-0.034807,-0.025927,-0.007516,0.012911,-0.023806,0.012839,0.038153,0.000646,0.021145,0.014953,-0.039497,-0.002067,-0.007167,0.014953,-0.029695,0.007483,0.001491,-0.041263,0.038048,0.003923,-0.040498,0.001550,0.021066,-0.039945,-0.004687,-0.050537,-0.002617,-0.019643,-0.013135,0.012753,0.027561,0.000991,-0.027983,-0.005023,-0.006610,-0.014927,-0.000629,0.023754,-0.017667,0.022423,-0.011567,-0.010454,-0.043344,0.053963,-0.030143,0.007134,0.000787,0.007180,0.019274,-0.009479,0.006759,-0.028958,-0.005211,-0.012898,0.022726,0.009762,0.003527,0.024412,-0.032093,0.027192,-0.005043,-0.024202,0.000920,0.026836,-0.022397,0.003445,-0.010540,-0.012015,0.032646,-0.001645,-0.038522,-0.070246,0.031882,0.003676,0.009360,-0.036098,0.003170,-0.009077,0.012786,-0.054384,-0.027587,-0.006726,-0.016929,-0.027034,-0.011818,-0.027587,0.005662,-0.011824,0.004476,-0.022212,0.002161,-0.032725,-0.032541,-0.004091,-0.020592,-0.012707,-0.014821,0.022239,-0.027825,0.012483,0.015638,-0.002100,0.015888,-0.027904,-0.008122,0.007951,0.018655,-0.024439,-0.029274,-0.036335,0.037337,-0.004598,-0.027429,-0.006726,-0.020803,-0.004637,-0.003422,0.002052,-0.028193,-0.009716,0.005678,-0.007048,-0.001894,0.000518,-0.022067,0.023003,-0.041869,-0.034201,-0.006324,0.015638,-0.003877,-0.020473,-0.012615,-0.019472,-0.000268,0.004819,0.022423,-0.003132,0.070299,0.012371,0.002189,-0.069614,0.017087,0.012615,0.010961,-0.006544,0.000909,-0.000922,0.008017,0.005965,-0.020473,-0.018023,-0.031566,0.008188,0.001586,-0.062236,-0.008372,0.013965,-0.007681,0.025308,0.030960,-0.007569,-0.045004,0.072618,-0.016811,-0.010256,-0.000734,0.013398,0.073883,0.008333,-0.016363,-0.016178,0.042896,-0.027983,0.000831,-0.039207,0.009255,-0.001792,0.012575,-0.004170,-0.003722,-0.017193,-0.027825,0.018168,0.014676,-0.002814,-0.040894,-0.009505,-0.046717,0.004413,0.005484,-0.006943,-0.002302,-0.009281,0.013873,0.020262,-0.033990,-0.033094,-0.015796,0.010724,-0.013688,0.000902,-0.027350,0.020078,0.015809,0.013807,0.048719,-0.002788,-0.004189,-0.005945,-0.047876,0.069719,-0.011258,0.013451,0.011403,-0.011225,0.002773,-0.000937,0.006347,0.031961,-0.007654,-0.019814,-0.043081,0.007569,0.002915,-0.041526,-0.039444,0.013754,-0.012542,0.020355,0.020723,0.032541,-0.007081,0.000314,-0.018602,0.001910,0.012272,-0.010757,-0.018023,-0.015124,-0.034886,-0.009512,-0.048140,0.024241,-0.021106,-0.030591,-0.032857,0.030275,0.011271,0.009947,0.006571,-0.000477,-0.009044,-0.023951,0.022015,-0.045426,-0.000209,0.018036,0.006156,0.039971,0.029932,-0.008445,0.001189,0.031355,-0.005434,0.009664,-0.027192,0.002961,0.012858,-0.068244,0.006811,-0.002768,-0.003886,0.010454,-0.004101,0.057968,0.007740,0.004861,0.007358,-0.010125,-0.045795,0.045689,-0.013293,-0.014821,-0.006156,-0.019511,-0.001231,0.011291,0.016850,0.011422,0.014163,0.012331,0.033279,0.021132,0.012628,-0.020276,-0.002518,-0.024570,0.033042,0.015256,0.031619,-0.005846,0.006818,0.045505,-0.008208,0.017035,0.004084,0.010013,-0.016626,0.022107,-0.009624,0.023082,0.006903,-0.007246,0.006903,-0.004522,0.009018,-0.009209,0.044372,0.013504,-0.011785,0.011897,-0.054015,-0.008886,0.057125,0.024979,-0.010790,-0.034544,0.002968,-0.019696,0.001394,0.009861,-0.012186,0.007259,0.011778,-0.032462,-0.002964,0.032646,0.025387,0.039998,0.009670,-0.024215,-0.010638,-0.033832,-0.013701,0.020829,-0.000906,0.015862,-0.044556,-0.022107,0.063396,0.004061,0.010908,-0.008530,-0.002963,-0.006844,0.012536,-0.021883,-0.022041,0.038496,0.013056,-0.024821,0.000236,0.007233,-0.024702,0.014663,-0.017483,0.009459,0.034623,0.022607,0.009453,0.033147,0.023885,0.035914,-0.053146,0.026823,-0.015467,-0.019525,-0.015796,0.014531,0.043713,-0.001308,-0.015217,-0.040946,-0.015454,0.061499,0.029748,0.023332,-0.013609,-0.000963,0.000519,-0.075253,0.016692,0.002968,-0.004269,0.024610,0.026850,-0.034122,-0.003379,-0.014558,-0.006676,0.000322,0.051381,0.043081,-0.001019,0.025018,0.004868,0.005523,-0.044583,-0.012279,0.007035,-0.022331,0.014031,0.000642,0.002268,-0.016942,-0.030275,0.005240,0.003577,0.017035,0.010704,-0.002342,0.001417,0.005698,-0.003073,0.005573,0.000946,0.001345,0.053146,0.019353,0.012364,0.051776,0.016995,-0.027298,0.013622,-0.022054,0.000194,-0.011152,0.068560,-0.026270,-0.014703,0.024834,0.015019,-0.009953,0.018826,-0.016600,-0.016942,-0.040657,0.030881,-0.021870,0.042923,-0.012852,0.006001,-0.047270,-0.022252,0.021975,-0.000467,0.018760,-0.005668,-0.007068,-0.001000,-0.015467,-0.009855,-0.003445,-0.009947,-0.009999,0.013135,-0.024188,-0.048192,-0.039629,0.047586,0.006591,-0.002520,0.019511,-0.011508,-0.021791,0.042633,0.015704,0.033911,0.052566,-0.005158,-0.013925,0.006650,0.002650,0.033832,0.005257,-0.030934,-0.009288,-0.003356,-0.006077,-0.016007,-0.007681,-0.008188,0.021804,0.025901,-0.031065,0.035097,0.045215,-0.004394,-0.010190,0.007167,0.007042,-0.016389,-0.006996,0.012476,0.034096,-0.007496,-0.022370,-0.036941,-0.008524,0.029221,-0.013899,-0.032462,-0.023411,0.035914,-0.009150,-0.023108,-0.000484,-0.044583,-0.001623,0.013464,0.010671,-0.002083,-0.045057,0.017101,-0.028536,0.018708,-0.019406,-0.022805,-0.037784,-0.011515,-0.004226,0.011646,0.038391,-0.002808,-0.023596,-0.032699,-0.006703,-0.008445,0.003567,0.020210,-0.015348,-0.032594,-0.022463,-0.032515,-0.023833,0.003371,0.018734,-0.029801,-0.037732,-0.006587,-0.006838,-0.004008,-0.014439,0.035808,-0.033200,-0.016956,0.006864,-0.022041,-0.007029,-0.013754,-0.001958,0.008794,-0.007911,-0.043002,0.034412,0.014769,-0.014795,0.011080,-0.012055,-0.025111,0.027429,-0.005316,-0.035097,-0.011225,0.009051,-0.009347,0.008267,0.004901,-0.007668,0.027350,0.052145,-0.038812,-0.030960,0.033015,-0.003030,0.000037,-0.007924,-0.017654,0.035861,-0.005359,-0.000187,-0.025203,0.020223,0.035018,0.025901,0.018642,0.018787,0.009110,-0.009183,0.024096,-0.006735,-0.034649,0.010401,0.005217,-0.012937,0.017483,-0.006982,0.002837,-0.008181,0.023003,0.012740,-0.006673,-0.012575,-0.035176,-0.023833,-0.031355,0.035624,-0.015058,-0.012147,-0.000295,0.024004,0.002530,-0.017430,0.053067,-0.015796,-0.010078,-0.037705,-0.022713,0.045953,0.024057,0.024346,0.000865,0.006129,0.016297,-0.015348,-0.013939,0.023833,-0.011159,0.037732,0.002530,0.012397,0.008610,0.025980,-0.003840,0.102392,-0.004219,-0.026217,-0.018523,0.005826,-0.018471,-0.001211,0.003863,-0.000954,0.036651,-0.011936,-0.024584,0.018497,-0.012957,0.010731,-0.008814,0.016784,-0.000486,-0.004960,-0.006838,-0.005649,-0.006798,0.019735,0.011534,-0.011488,0.024650,-0.004908,-0.025071,0.019551,0.001186,0.043423,-0.005494,0.015414,0.005306,0.000897,-0.014268,0.013076,-0.020934,0.004772,-0.000598,-0.000449,0.009670,-0.017166,-0.012200,0.045057,-0.004005,0.009150,-0.006479,-0.007681,0.046269,0.027008,0.023661,-0.003485,0.012852,-0.006989,-0.043054,0.010144,0.021501,0.034227,-0.020750,-0.008135,-0.032251,0.033727,-0.007094,0.006587,-0.015612,0.000004,0.016047,0.008537,0.018247,0.015032,0.030828,0.015388,-0.041289,0.005151,0.005589,0.038048,0.002485,-0.040551,0.033200,-0.012450,0.001470,0.031566,0.000723,0.008195,0.017865,-0.029037,-0.020934,-0.021053,-0.015836,0.023516,-0.009973,0.008939,0.006673,-0.006943,0.014189,0.014914,0.012002,-0.011528,0.007193,0.001424,-0.031592,-0.018550,0.003122,0.016152,0.016297,0.001457,0.017667,-0.017140,-0.007127,-0.001606,-0.004944,0.025242,-0.006726,0.023793,0.016639,-0.016797,0.005846,-0.019538,0.014387,0.006261,-0.020447,0.001677,-0.038470,0.017601,0.000491,-0.024505,0.022080,-0.011732,-0.005438,0.037679,0.017048,0.013846,-0.003147,-0.029405,0.020565,0.005398,-0.011277,-0.008498,0.003475,0.057599,0.039102,0.020513,-0.019656,0.016547,-0.007793,0.050458,0.007167,0.002814,-0.015915,0.002625,0.009973,-0.003679,0.024399,-0.003906,0.003396,-0.015849,0.014848,-0.022410,-0.020763,0.010573,0.022436,-0.009288,0.006416,0.025361,-0.002549,-0.013056,0.042422,-0.037178,-0.011389,0.018919,-0.018444,-0.042211,0.003101,0.020131,0.002278,-0.003913,0.002721,-0.056334,0.015717,-0.002083,-0.001049,0.022212,0.025414,-0.024241,0.047007,0.018510,0.010843,0.042369,0.000359,0.013181,-0.017917,0.022054,-0.002007,-0.030328,0.007365,-0.041342,0.032488,0.013069,-0.015823,-0.014663,-0.008392,-0.002334,0.047797,0.043687,-0.027666,0.014387,0.005612,0.013194,-0.008642,0.019538,-0.012298,0.001421,-0.006113,-0.015981,0.046611,0.031171,0.018168,-0.044424,0.009130,0.004581,-0.017838,0.015401,-0.021053,-0.036045,0.000068,0.035150,0.012114,-0.005721,-0.039418,0.027746,0.043160,0.000692,-0.007312,0.024215,0.035360,-0.017298,0.040182,-0.035413,-0.000047,0.018523,-0.005217,-0.007766,-0.000238,0.002035,0.024254,0.040709,-0.007714,-0.009492,0.034201,-0.045452,0.006824,0.015730,-0.046901,-0.005586,-0.006120,0.029221,-0.000068,0.015111,-0.013978,0.003643,-0.006759,-0.004766,-0.014321,-0.014228,-0.010553,-0.017588,0.024149,0.000536,0.031382,0.048667,-0.013280,0.001573,-0.008978,-0.036520,0.036651,0.013846,0.037758,-0.000671,-0.033832,-0.025045,0.000839,-0.019393,-0.028668,-0.016837,0.031856,-0.020341,0.013820,0.018998,-0.041157,0.032515,-0.013807,0.023029,-0.001734,0.038865,0.011554,0.007523,-0.017720,-0.021738,-0.009137,0.033569,0.016890,-0.003860,0.001945,0.017008,-0.011363,0.020618,0.031961,0.021250,-0.035835,0.028905,0.013570,-0.028562,-0.028088,0.026270,0.046243,-0.000874,0.013846,-0.015678,0.035598,0.039761,0.003936,-0.026916,-0.034833,-0.036098,-0.038628,0.008366,-0.019485,0.027324,0.001168,0.009400,-0.003511,-0.007516,0.004078,-0.022423,-0.030486,-0.024360,0.008787,-0.016890,-0.034781,-0.012226,0.024162,-0.006963,0.022318,0.000577,-0.026718,-0.010513,-0.026468,-0.004305,-0.013016,-0.041157,-0.007397,-0.029142,-0.020671,-0.020276,-0.003109,0.016942,0.015981,-0.043739,0.030986,-0.000794,0.038311,0.025519,0.002256,-0.001578,0.008458,0.011897,0.014202,-0.005283,-0.006650,-0.019880,0.001201,0.004443,0.031171,0.011001,-0.007318,-0.016521,-0.011053,-0.018378,0.016574,-0.008926,0.015019,-0.030881,0.003137,-0.028114,0.028325,-0.004865,0.009321,-0.005589]::vector ASC,
         e.created_at DESC
LIMIT 1;

### SQL (fts+trgm, caption) ###
SELECT
  e.id,
  e.title,
  concat('https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/', e.storage_path) AS imageUrl
FROM eagle_images e
CROSS JOIN LATERAL (
  SELECT
    setweight(to_tsvector('english', unaccent(coalesce(e.caption,''))), 'A') || setweight(to_tsvector('simple',  unaccent(array_to_string(e.tags,' '))), 'B') || setweight(to_tsvector('simple',  unaccent(coalesce(e.title,''))), 'C') AS tsv,
    websearch_to_tsquery('english', unaccent('rainforest')) AS q_web,
    plainto_tsquery('simple',  unaccent('rainforest'))       AS q_plain,
    similarity(unaccent(coalesce(e.caption,'')), unaccent('rainforest')) AS cap_sim,
    similarity(unaccent(coalesce(e.title,'')),   unaccent('rainforest')) AS title_sim,
    (SELECT max(similarity(unaccent(tag), unaccent('rainforest'))) FROM unnest(e.tags) AS tag) AS tag_sim
) s
ORDER BY
  (0.9*COALESCE(ts_rank_cd(s.tsv, s.q_web), 0) + 0.8*COALESCE(ts_rank_cd(s.tsv, s.q_plain), 0)) +
  (0.8*COALESCE(s.cap_sim,0) + 0.6*COALESCE(s.tag_sim,0) + 0.4*COALESCE(s.title_sim,0)) +
  (0.05 * (extract(epoch from (now() - e.created_at)) * -1.0 / 86400.0)) +
  (0.02*random()) DESC,
  e.created_at DESC
LIMIT 1;

### Discord Post ###
Channel: lucid
Media: https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO251FOAKWC8V.jpg
Args: {"channel": "lucid", "message": "", "mediaUrl": "https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO251FOAKWC8V.jpg", "imageUrl": "https://idyoveanwiuwcvgxijtz.supabase.co/storage/v1/object/public/eagle-images/images/LO251FOAKWC8V.jpg"}
Result: {"content": [{"type": "text", "text": "Message sent successfully to #lucid in dreamsim.exe. Message ID: 1416050142578081802", "annotations": null, "_meta": null}], "isError": false, "model": null}
